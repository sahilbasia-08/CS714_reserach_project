{"ast":null,"code":"var _jsxFileName = \"/home/rubbish/secure_messaging_platform/client/src/components/Messages/Message/Message.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport \"./Message.css\";\n\n/**\n * Props:\n * - message: { message_id, message_text, message_sender }\n * - current_user_name: string\n * - editMessage: fn(originalMessage, editedMessageText)\n */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Message = ({\n  message,\n  current_user_name,\n  editMessage\n}) => {\n  _s();\n  const {\n    message_id,\n    message_text,\n    message_sender\n  } = message;\n  const isOwn = message_sender === current_user_name;\n  const [isEditing, setIsEditing] = useState(false);\n  const [editedMessageText, setEditedMessageText] = useState(message_text);\n  const textAreaRef = useRef(null);\n\n  // keep edited text in sync if a different message instance arrives\n  useEffect(() => {\n    setEditedMessageText(message_text);\n  }, [message_text]);\n\n  // auto-resize textarea\n  useEffect(() => {\n    if (!isEditing || !textAreaRef.current) return;\n    const el = textAreaRef.current;\n    el.style.height = \"0px\";\n    el.style.height = Math.min(el.scrollHeight, 300) + \"px\";\n  }, [isEditing, editedMessageText]);\n  const startEdit = () => setIsEditing(true);\n  const saveEdit = useCallback(() => {\n    const next = editedMessageText !== null && editedMessageText !== void 0 ? editedMessageText : \"\";\n    if (next.trim() === message_text.trim()) {\n      setIsEditing(false);\n      return;\n    }\n    editMessage(message, next);\n    setIsEditing(false);\n  }, [editedMessageText, message, message_text, editMessage]);\n  const cancelEdit = () => {\n    setEditedMessageText(message_text);\n    setIsEditing(false);\n  };\n  const onKeyDown = e => {\n    if (e.key === \"Enter\" && (e.ctrlKey || e.metaKey)) {\n      e.preventDefault();\n      saveEdit();\n    } else if (e.key === \"Escape\") {\n      e.preventDefault();\n      cancelEdit();\n    }\n  };\n  const copyId = async () => {\n    try {\n      await navigator.clipboard.writeText(String(message_id));\n      // non-intrusive feedback\n      console.log(\"Message ID copied\");\n    } catch (e) {\n      console.warn(\"Copy failed\", e);\n    }\n  };\n  const hasChanged = (editedMessageText !== null && editedMessageText !== void 0 ? editedMessageText : \"\").trim() !== (message_text !== null && message_text !== void 0 ? message_text : \"\").trim();\n\n  // content block (edit vs read)\n  const content = isEditing ? /*#__PURE__*/_jsxDEV(\"textarea\", {\n    ref: textAreaRef,\n    className: \"editArea\",\n    value: editedMessageText,\n    onChange: e => setEditedMessageText(e.target.value),\n    onKeyDown: onKeyDown,\n    \"aria-label\": \"Edit message\",\n    autoFocus: true\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 74,\n    columnNumber: 5\n  }, this) : /*#__PURE__*/_jsxDEV(\"p\", {\n    className: `messageText ${isOwn ? \"colorWhite\" : \"colorDark\"}`,\n    children: message_text\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 84,\n    columnNumber: 5\n  }, this);\n\n  // meta row (id + actions)\n  const meta = /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"metaRow\",\n    children: [/*#__PURE__*/_jsxDEV(\"span\", {\n      className: \"metaId\",\n      title: `id: ${message_id}`,\n      children: [\"id: \", message_id]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"buttonRow\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"smallBtn\",\n        onClick: copyId,\n        \"aria-label\": \"Copy message id\",\n        children: \"Copy ID\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this), isOwn && !isEditing && /*#__PURE__*/_jsxDEV(\"button\", {\n        type: \"button\",\n        className: \"smallBtn\",\n        onClick: startEdit,\n        children: \"Edit\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 98,\n        columnNumber: 11\n      }, this), isOwn && isEditing && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"smallBtn\",\n          onClick: saveEdit,\n          disabled: !hasChanged,\n          title: hasChanged ? \"Save (Ctrl/Cmd+Enter)\" : \"No changes\",\n          children: \"Save\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          type: \"button\",\n          className: \"smallBtn\",\n          onClick: cancelEdit,\n          children: \"Cancel\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 93,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 91,\n    columnNumber: 5\n  }, this);\n\n  // bubble wrapper with side alignment\n  const bubble = /*#__PURE__*/_jsxDEV(\"div\", {\n    className: `messageBox ${isOwn ? \"backgroundBlue\" : \"backgroundLight\"}`,\n    children: [content, meta]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 124,\n    columnNumber: 5\n  }, this);\n  return isOwn ? /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"messageContainer justifyEnd\",\n    children: [/*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"sentText pr-10\",\n      children: current_user_name\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 7\n    }, this), bubble]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 131,\n    columnNumber: 5\n  }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"messageContainer justifyStart\",\n    children: [bubble, /*#__PURE__*/_jsxDEV(\"p\", {\n      className: \"sentText pl-10\",\n      children: message_sender\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 136,\n    columnNumber: 5\n  }, this);\n};\n_s(Message, \"hJZIU80+jbqd8pkwH6SET02TMgo=\");\n_c = Message;\nexport default Message;\nvar _c;\n$RefreshReg$(_c, \"Message\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useCallback","jsxDEV","_jsxDEV","Fragment","_Fragment","Message","message","current_user_name","editMessage","_s","message_id","message_text","message_sender","isOwn","isEditing","setIsEditing","editedMessageText","setEditedMessageText","textAreaRef","current","el","style","height","Math","min","scrollHeight","startEdit","saveEdit","next","trim","cancelEdit","onKeyDown","e","key","ctrlKey","metaKey","preventDefault","copyId","navigator","clipboard","writeText","String","console","log","warn","hasChanged","content","ref","className","value","onChange","target","autoFocus","fileName","_jsxFileName","lineNumber","columnNumber","children","meta","title","type","onClick","disabled","bubble","_c","$RefreshReg$"],"sources":["/home/rubbish/secure_messaging_platform/client/src/components/Messages/Message/Message.js"],"sourcesContent":["import React, { useState, useEffect, useRef, useCallback } from \"react\";\nimport \"./Message.css\";\n\n/**\n * Props:\n * - message: { message_id, message_text, message_sender }\n * - current_user_name: string\n * - editMessage: fn(originalMessage, editedMessageText)\n */\nconst Message = ({ message, current_user_name, editMessage }) => {\n  const { message_id, message_text, message_sender } = message;\n  const isOwn = message_sender === current_user_name;\n\n  const [isEditing, setIsEditing] = useState(false);\n  const [editedMessageText, setEditedMessageText] = useState(message_text);\n\n  const textAreaRef = useRef(null);\n\n  // keep edited text in sync if a different message instance arrives\n  useEffect(() => {\n    setEditedMessageText(message_text);\n  }, [message_text]);\n\n  // auto-resize textarea\n  useEffect(() => {\n    if (!isEditing || !textAreaRef.current) return;\n    const el = textAreaRef.current;\n    el.style.height = \"0px\";\n    el.style.height = Math.min(el.scrollHeight, 300) + \"px\";\n  }, [isEditing, editedMessageText]);\n\n  const startEdit = () => setIsEditing(true);\n\n  const saveEdit = useCallback(() => {\n    const next = editedMessageText ?? \"\";\n    if (next.trim() === message_text.trim()) {\n      setIsEditing(false);\n      return;\n    }\n    editMessage(message, next);\n    setIsEditing(false);\n  }, [editedMessageText, message, message_text, editMessage]);\n\n  const cancelEdit = () => {\n    setEditedMessageText(message_text);\n    setIsEditing(false);\n  };\n\n  const onKeyDown = (e) => {\n    if ((e.key === \"Enter\" && (e.ctrlKey || e.metaKey))) {\n      e.preventDefault();\n      saveEdit();\n    } else if (e.key === \"Escape\") {\n      e.preventDefault();\n      cancelEdit();\n    }\n  };\n\n  const copyId = async () => {\n    try {\n      await navigator.clipboard.writeText(String(message_id));\n      // non-intrusive feedback\n      console.log(\"Message ID copied\");\n    } catch (e) {\n      console.warn(\"Copy failed\", e);\n    }\n  };\n\n  const hasChanged =\n    (editedMessageText ?? \"\").trim() !== (message_text ?? \"\").trim();\n\n  // content block (edit vs read)\n  const content = isEditing ? (\n    <textarea\n      ref={textAreaRef}\n      className=\"editArea\"\n      value={editedMessageText}\n      onChange={(e) => setEditedMessageText(e.target.value)}\n      onKeyDown={onKeyDown}\n      aria-label=\"Edit message\"\n      autoFocus\n    />\n  ) : (\n    <p className={`messageText ${isOwn ? \"colorWhite\" : \"colorDark\"}`}>\n      {message_text}\n    </p>\n  );\n\n  // meta row (id + actions)\n  const meta = (\n    <div className=\"metaRow\">\n      <span className=\"metaId\" title={`id: ${message_id}`}>id: {message_id}</span>\n      <div className=\"buttonRow\">\n        <button type=\"button\" className=\"smallBtn\" onClick={copyId} aria-label=\"Copy message id\">\n          Copy ID\n        </button>\n        {isOwn && !isEditing && (\n          <button type=\"button\" className=\"smallBtn\" onClick={startEdit}>\n            Edit\n          </button>\n        )}\n        {isOwn && isEditing && (\n          <>\n            <button\n              type=\"button\"\n              className=\"smallBtn\"\n              onClick={saveEdit}\n              disabled={!hasChanged}\n              title={hasChanged ? \"Save (Ctrl/Cmd+Enter)\" : \"No changes\"}\n            >\n              Save\n            </button>\n            <button type=\"button\" className=\"smallBtn\" onClick={cancelEdit}>\n              Cancel\n            </button>\n          </>\n        )}\n      </div>\n    </div>\n  );\n\n  // bubble wrapper with side alignment\n  const bubble = (\n    <div className={`messageBox ${isOwn ? \"backgroundBlue\" : \"backgroundLight\"}`}>\n      {content}\n      {meta}\n    </div>\n  );\n\n  return isOwn ? (\n    <div className=\"messageContainer justifyEnd\">\n      <p className=\"sentText pr-10\">{current_user_name}</p>\n      {bubble}\n    </div>\n  ) : (\n    <div className=\"messageContainer justifyStart\">\n      {bubble}\n      <p className=\"sentText pl-10\">{message_sender}</p>\n    </div>\n  );\n};\n\nexport default Message;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}