{"ast":null,"code":"var _jsxFileName = \"/home/rubbish/secure_messaging_platform/client/src/components/Chat/Chat.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport io from \"socket.io-client\";\nimport Messages from \"../Messages/Messages\";\nimport InfoBar from \"../InfoBar/InfoBar\";\nimport Input from \"../Input/Input\";\nimport \"./Chat.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction Chat() {\n  _s();\n  const location = useLocation();\n  const socketRef = useRef(null);\n  const [user_name, set_user_name] = useState(\"\");\n  const [user_room, set_user_room] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n  const ENDPOINT = process.env.REACT_APP_ENDPOINT || \"http://localhost:5001\";\n  const [roomPubKey, setRoomPubKey] = useState(null);\n  useEffect(() => {\n    const {\n      user_name: qName,\n      user_room: qRoom\n    } = queryString.parse(location.search);\n    if (!qName || !qRoom) return;\n    set_user_name(String(qName));\n    set_user_room(String(qRoom));\n    if (socketRef.current) {\n      try {\n        socketRef.current.disconnect();\n      } catch {}\n    }\n    const socket = io(ENDPOINT, {\n      transports: [\"websocket\", \"polling\"],\n      withCredentials: true\n    });\n    socketRef.current = socket;\n    socket.emit(\"join\", {\n      user_name: String(qName),\n      user_room: String(qRoom)\n    });\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.off();\n        socketRef.current.disconnect();\n        socketRef.current = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [location.search]);\n  useEffect(() => {\n    const s = socketRef.current;\n    if (!s) return;\n    const onMsg = msg => setMessages(prev => [...prev, msg]);\n    s.on(\"message\", onMsg);\n    return () => s.off(\"message\", onMsg);\n  }, []);\n  useEffect(() => {\n    const s = socketRef.current;\n    if (!s) return;\n    const onEdited = ({\n      originalMessage,\n      editedMessageText\n    }) => {\n      setMessages(prev => prev.map(m => m.message_id === originalMessage.message_id ? {\n        ...m,\n        message_text: editedMessageText\n      } : m));\n    };\n    s.on(\"editedMessage\", onEdited);\n    return () => s.off(\"editedMessage\", onEdited);\n  }, []);\n  useEffect(() => {\n    if (!user_room) return;\n    fetch(`${ENDPOINT}/roomPubKey?room=${encodeURIComponent(user_room)}`).then(r => r.ok ? r.json() : Promise.reject()).then(({\n      pubkey_b64\n    }) => setRoomPubKey(pubkey_b64 || null)).catch(() => setRoomPubKey(null));\n  }, [user_room, ENDPOINT]);\n  function editMessage(originalMessage, editedMessageText) {\n    const s = socketRef.current;\n    if (!s) return;\n    s.emit(\"editMessage\", {\n      user_room,\n      originalMessage,\n      editedMessageText\n    });\n  }\n  const sendMessage = event => {\n    if (event !== null && event !== void 0 && event.preventDefault) event.preventDefault();\n    const s = socketRef.current;\n    if (!s) return;\n    if (message && message.trim()) {\n      s.emit(\"sendMessage\", {\n        user_name,\n        user_room,\n        message_text: message.trim()\n      });\n      setMessage(\"\");\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"outerContainer\",\n    children: /*#__PURE__*/_jsxDEV(\"main\", {\n      className: \"container chatCard\",\n      role: \"main\",\n      \"aria-label\": \"Chat window\",\n      children: [/*#__PURE__*/_jsxDEV(InfoBar, {\n        user_room: user_room\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 95,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Messages, {\n        messages: messages,\n        current_user_name: user_name,\n        editMessage: editMessage\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 96,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(Input, {\n        message: message,\n        setMessage: setMessage,\n        sendMessage: sendMessage,\n        room: user_room,\n        roomPubKey: roomPubKey\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 93,\n    columnNumber: 5\n  }, this);\n}\n_s(Chat, \"0edjG4coTSI1g6JotNkbUDfVQFI=\", false, function () {\n  return [useLocation];\n});\n_c = Chat;\nexport default Chat;\nvar _c;\n$RefreshReg$(_c, \"Chat\");","map":{"version":3,"names":["React","useState","useEffect","useRef","useLocation","queryString","io","Messages","InfoBar","Input","jsxDEV","_jsxDEV","Chat","_s","location","socketRef","user_name","set_user_name","user_room","set_user_room","message","setMessage","messages","setMessages","ENDPOINT","process","env","REACT_APP_ENDPOINT","roomPubKey","setRoomPubKey","qName","qRoom","parse","search","String","current","disconnect","socket","transports","withCredentials","emit","off","s","onMsg","msg","prev","on","onEdited","originalMessage","editedMessageText","map","m","message_id","message_text","fetch","encodeURIComponent","then","r","ok","json","Promise","reject","pubkey_b64","catch","editMessage","sendMessage","event","preventDefault","trim","className","children","role","fileName","_jsxFileName","lineNumber","columnNumber","current_user_name","room","_c","$RefreshReg$"],"sources":["/home/rubbish/secure_messaging_platform/client/src/components/Chat/Chat.js"],"sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\nimport { useLocation } from \"react-router-dom\";\nimport queryString from \"query-string\";\nimport io from \"socket.io-client\";\n\nimport Messages from \"../Messages/Messages\";\nimport InfoBar from \"../InfoBar/InfoBar\";\nimport Input from \"../Input/Input\";\n\nimport \"./Chat.css\";\n\nfunction Chat() {\n  const location = useLocation();\n  const socketRef = useRef(null);\n\n  const [user_name, set_user_name] = useState(\"\");\n  const [user_room, set_user_room] = useState(\"\");\n  const [message, setMessage] = useState(\"\");\n  const [messages, setMessages] = useState([]);\n\n  const ENDPOINT = process.env.REACT_APP_ENDPOINT || \"http://localhost:5001\";\n  const [roomPubKey, setRoomPubKey] = useState(null);\n\n  useEffect(() => {\n    const { user_name: qName, user_room: qRoom } = queryString.parse(location.search);\n    if (!qName || !qRoom) return;\n\n    set_user_name(String(qName));\n    set_user_room(String(qRoom));\n\n    if (socketRef.current) {\n      try { socketRef.current.disconnect(); } catch {}\n    }\n    const socket = io(ENDPOINT, { transports: [\"websocket\", \"polling\"], withCredentials: true });\n    socketRef.current = socket;\n    socket.emit(\"join\", { user_name: String(qName), user_room: String(qRoom) });\n\n    return () => {\n      if (socketRef.current) {\n        socketRef.current.off();\n        socketRef.current.disconnect();\n        socketRef.current = null;\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [location.search]);\n\n  useEffect(() => {\n    const s = socketRef.current;\n    if (!s) return;\n    const onMsg = (msg) => setMessages((prev) => [...prev, msg]);\n    s.on(\"message\", onMsg);\n    return () => s.off(\"message\", onMsg);\n  }, []);\n\n  useEffect(() => {\n    const s = socketRef.current;\n    if (!s) return;\n    const onEdited = ({ originalMessage, editedMessageText }) => {\n      setMessages((prev) =>\n        prev.map((m) => (m.message_id === originalMessage.message_id ? { ...m, message_text: editedMessageText } : m))\n      );\n    };\n    s.on(\"editedMessage\", onEdited);\n    return () => s.off(\"editedMessage\", onEdited);\n  }, []);\n\n  useEffect(() => {\n    if (!user_room) return;\n    fetch(`${ENDPOINT}/roomPubKey?room=${encodeURIComponent(user_room)}`)\n      .then((r) => (r.ok ? r.json() : Promise.reject()))\n      .then(({ pubkey_b64 }) => setRoomPubKey(pubkey_b64 || null))\n      .catch(() => setRoomPubKey(null));\n  }, [user_room, ENDPOINT]);\n\n  function editMessage(originalMessage, editedMessageText) {\n    const s = socketRef.current;\n    if (!s) return;\n    s.emit(\"editMessage\", { user_room, originalMessage, editedMessageText });\n  }\n\n  const sendMessage = (event) => {\n    if (event?.preventDefault) event.preventDefault();\n    const s = socketRef.current;\n    if (!s) return;\n    if (message && message.trim()) {\n      s.emit(\"sendMessage\", { user_name, user_room, message_text: message.trim() });\n      setMessage(\"\");\n    }\n  };\n\n  return (\n    <div className=\"outerContainer\">\n      <main className=\"container chatCard\" role=\"main\" aria-label=\"Chat window\">\n        <InfoBar user_room={user_room} />\n        <Messages messages={messages} current_user_name={user_name} editMessage={editMessage} />\n        <Input message={message} setMessage={setMessage} sendMessage={sendMessage} room={user_room} roomPubKey={roomPubKey} />\n      </main>\n    </div>\n  );\n}\n\nexport default Chat;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}